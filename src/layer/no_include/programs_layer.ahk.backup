; ==============================
; Programs Layer (menu + routing)
; ==============================
; Shows programs menu based on programs.ini mapping and routes to program actions.
; Depends on: src/actions/program_actions (launch logic), core/config (GetEffectiveTimeout),
; ui/tooltips_native_wrapper (fallback), ui/tooltip_csharp_integration (CS menus)

; ---- Menu display ----
ShowProgramMenu() {
    if (IsSet(tooltipConfig) && tooltipConfig.enabled) {
        ShowProgramMenuCS()
    } else {
        ; Generate menu dynamically from ProgramMapping order
        menuText := GenerateProgramMenuText()
        ToolTipX := A_ScreenWidth // 2 - 120
        ToolTipY := A_ScreenHeight // 2 - 150
        ToolTip(menuText, ToolTipX, ToolTipY, 2)
    }
}

; ---- Build native tooltip menu text ----
GenerateProgramMenuText() {
    global ProgramsIni

    menuText := "PROGRAM LAUNCHER`n`n"

    orderStr := IniRead(ProgramsIni, "ProgramMapping", "order", "")
    if (orderStr = "" || orderStr = "ERROR") {
        orderStr := "e v n t o b z m w l r q p k f"  ; fallback order
    }

    keys := StrSplit(orderStr, " ")
    currentLine := ""
    Loop keys.Length {
        key := Trim(keys[A_Index])
        if (key = "")
            continue
        programName := IniRead(ProgramsIni, "ProgramMapping", key, "")
        if (programName = "" || programName = "ERROR")
            continue
        entry := key . " - " . programName
        if (currentLine = "") {
            currentLine := entry
        } else {
            menuText .= Format("{:-15s} {}", currentLine, entry) . "`n"
            currentLine := ""
        }
    }
    if (currentLine != "")
        menuText .= currentLine . "`n"
    menuText .= "`n[Backspace: Back] [Esc: Exit]"
    return menuText
}

; ==============================
; NOTA: Todas las funciones de lógica de lanzamiento han sido movidas a src/actions/program_actions.ahk
; Este layer ahora se enfoca únicamente en el menú y routing, siguiendo el patrón arquitectural
; establecido por windows_layer.ahk
; ==============================
